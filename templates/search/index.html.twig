{% extends 'layouts/base.html.twig' %}

{% block title %}
	{% if mots %}
		Les résultats de recherche pour "{{ mots }}"
	{% else %}
		tous les établissements
	{% endif %}
{% endblock %}

{% block body %}
	<section class="show_secteurs">
		<h1 class="title text-center pt-4">
			{% if mots %}
				Les résultats de recherche pour "<span>{{ mots }}</span>"
			{% else %}
				tous les
				<span>établissements</span>
			{% endif %}

		</h1>
		<div
			class="container">
			{# Bloc Search #}
			{{ include('search/search.html.twig') }}
			<div class="row justify-content-center mb-4 mt-5">
				{% for key, etablissement in pagination %}
					{% set idUrl = etablissement.video | parse_url %}

					<div class="col-12 col-sm-6 col-lg-3 mb-4">
						<div class="card d-flex flex-column">
							<img src="https://img.youtube.com/vi/{{idUrl}}/hqdefault.jpg" class="card-img-top flex-grow-1" alt="{{etablissement.name}}">
							<div class="card-img" style="background: url('{{ asset('uploads/etablissements/' ~ etablissement.logo) }}') center, #fff;"></div>
							{% if etablissement.dateLimitInscription %}

								{% set isOpenForInscription = date() < etablissement.dateLimitInscription %}
								{% if isOpenForInscription %}
									<span class="card-inscription text-uppercase">Inscription ouverte</span>
									<span class="card-pulse"></span>
									<span class="card-marker"></span>
								{% endif %}

							{% endif %}

							<h2 class="card-title">
								({{etablissement.sigle}})
								<span data-bs-toggle="tooltip" data-bs-placement="top" title="{{etablissement.name}}">{{etablissement.name | u.truncate(28, '...')}}</span>
							</h2>
							<p class="card-text">
								{% set villes = [] %}
								{% for ville in etablissement.villes %}
									{% set villes = villes|merge([ville]) %}
								{% endfor %}

								{% if villes %}
									<small class="text-muted" data-bs-toggle="tooltip" data-bs-placement="top" title="{{villes | join(', ')}}">
										<i class="fa-solid fa-location-dot"></i>
										{{ villes | join(', ') | u.truncate(38, ', et plus...') }}
									</small>
									<br>
								{% endif %}

								<small class="text-muted">
									<i class="fa-regular fa-calendar-days"></i>
									Durée de la formation:
									{{etablissement.dureeFormation ? etablissement.dureeFormation ~ ' mois' : ''}}
								</small>


								{% if etablissement.typeBac %}
									<br>

									<small class="text-muted">
										<i class="fa-solid fa-graduation-cap"></i>
										Type bac:
										<span data-bs-toggle="tooltip" data-bs-placement="top" title="{{etablissement.typeBac | join(', ')}}">
											{{ etablissement.typeBac | join(', ') | u.truncate(38, ', et plus...') }}
										</span>
									</small>
								{% endif %}

								{% if etablissement.diplome %}
									<br>

									<small class="text-muted">
										<i class="fa-solid fa-certificate"></i>
										Diplôme:
										<span data-bs-toggle="tooltip" data-bs-placement="top" title="{{etablissement.diplome}}">
											{{ etablissement.diplome | u.truncate(40, '...') }}
										</span>
									</small>
									<br>
								{% endif %}
							</p>
							<div class="card-play">
								<i class="fa-regular fa-circle-play video-btn" data-bs-toggle="modal" data-src="{{idUrl}}" data-bs-target="#modalVideo"></i>
							</div>
							<div class="card-footer d-flex justify-content-center align-items-center gap-2">
								<a href="javascript:void(0)" class="card-seuil" data-bs-toggle="modal" data-bs-target="#modalSeuil{{key}}">
									<i class="fa-solid fa-list-check" data-bs-toggle="tooltip" data-bs-placement="top" title="Seuils"></i>
								</a>
								{% if etablissement.documentEtablissements|length > 0 %}
									<a href="javascript:void(0)" class="card-docs" data-bs-toggle="modal" data-bs-target="#modalDocs{{key}}">
										<i class="fa-solid fa-folder-open" data-bs-toggle="tooltip" data-bs-placement="top" title="Documents"></i>
									</a>
								{% endif %}
								{% if etablissement.phone %}
									<a href="javascript:void(0)" class="card-phone" data-bs-toggle="modal" data-bs-target="#modalTel{{key}}">
										<i class="fa-solid fa-phone" data-bs-toggle="tooltip" data-bs-placement="top" title="Téléphone"></i>
									</a>
								{% endif %}

								{% if etablissement.phoneWP %}
									<a href="https://wa.me/{{etablissement.phoneWP}}" data-bs-toggle="tooltip" data-bs-placement="top" title="Whatsapp" class="card-whatsapp" target="_blank">
										<i class="fa-brands fa-whatsapp"></i>
									</a>
								{% endif %}

								{% if etablissement.fb %}
									<a href="{{etablissement.fb}}" class="card-fb" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" target="_blank">
										<i class="fa-brands fa-facebook"></i>
									</a>
								{% endif %}

								{% if etablissement.website %}
									<a href="{{etablissement.website}}" class="card-website" data-bs-toggle="tooltip" data-bs-placement="top" title="Site web" target="_blank">
										<i class="fa-solid fa-globe"></i>
									</a>
								{% endif %}
								{# Modal Seuil #}
								{{ include('search/modal_seuil.html.twig') }}

								{# Modal Docs #}
								{{ include('search/modal_docs.html.twig') }}

								{# Modal Tel #}
								{{ include('search/modal_tel.html.twig') }}

							</div>
						</div>
					</div>
				{% else %}
					<div class="text-center">
						<h5 class=" text-uppercase ">Aucun établissement trouvé</h5>
						<img src="{{ asset('uploads/images/notfound.png') }}" class=" mb-2">
					</div>
				{% endfor %}
			</div>
		</div>

		<div class="d-flex justify-content-center py-4">
			{{ knp_pagination_render(pagination) }}
		</div>

		{# Modal video #}
		{{ include('search/modal_video.html.twig') }}

	</section>
{% endblock %}
